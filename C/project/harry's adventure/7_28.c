#include <conio.h>
#include <time.h>
#include<MMSystem.h>
#pragma comment(lib,"Winmm.lib")

#define WALL 1 //(임시) 맵파일 나온 후에 이용
#define EMPTY 0
#define CEILLING -1

#define SPACEBAR 64 //사용할 키
#define LEFT 75
#define RIGHT 77
#define UP 72
#define DOWN 80
#define ENTER 13
#define P 80
#define p 112

int gotoxy(int, int); //함수들
int mainscreen();
int reset();
int GameTitleA();
int GameA();
int map();
int keeper();
int Harry();
int pause();



int gotoxy(int x, int y)
{
	COORD Pos;
	Pos.X = x;
	Pos.Y = y;
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), Pos);

	return 0;
}


int main()
{
	CONSOLE_CURSOR_INFO cursorInfo = { 0, };
	cursorInfo.dwSize = 1;
	cursorInfo.bVisible = FALSE;
	SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &cursorInfo);
	SetConsoleTitleA("Harry's Adventure");

	mainscreen();
	reset();
	GameA();

	return 0;
}

int mainscreen()
{
	system("mode con: cols=150 lines=40"); //콘솔창 크기 조절

	GameTitleA();
	PlaySound(TEXT("music\\start button.wav"), NULL, SND_ASYNC | SND_NODEFAULT); //시작 버튼 음
	Sleep(700);

	return 0;

}

int GameTitleA()
{
	PlaySound(TEXT("music\\Kirby.wav"), NULL, SND_ASYNC | SND_LOOP); // 타이틀 음악 무한반복
	gotoxy(10, 4);
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 6); //타이틀 위치와 색깔
	printf("        ■■        ■■        ■■■■         ■■■■■■          ■■■■■■         ■■     ■■");
	gotoxy(10, 5);
	printf("       ■■        ■■      ■■    ■■      ■■        ■■     ■■        ■■      ■■      ■■");
	gotoxy(10, 6);
	printf("      ■■        ■■     ■■      ■■     ■■         ■■    ■■         ■■    ■■      ■■     ■■");
	gotoxy(10, 7); 
	printf("     ■■■■■■■■    ■■        ■■    ■■        ■■     ■■        ■■     ■■     ■■         ■ ");
	gotoxy(10, 8);
	printf("    ■■■■■■■■    ■■■■■■■■    ■■       ■■      ■■       ■■      ■■    ■■                   ■■■■");
	gotoxy(10, 9);
	printf("   ■■        ■■    ■■        ■■    ■■■■■■■■     ■■■■■■■■        ■■■                    ■■");
	gotoxy(10, 10);
	printf("  ■■        ■■    ■■        ■■    ■■         ■■    ■■         ■■       ■■■                       ■■■■");
	gotoxy(10, 11);
	printf(" ■■        ■■    ■■        ■■    ■■         ■■    ■■         ■■       ■■■                               ■■");
	gotoxy(10, 12);
	printf("■■        ■■    ■■        ■■    ■■         ■■    ■■         ■■       ■■■                       ■■■■■\n");


	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 3);
	gotoxy(5, 15);
	printf("    ■■■■       ■■■■■      ■■       ■■  ■■■■■■  ■■      ■■  ■■■■■■ ■■       ■■  ■■■■■      ■■■■■■");
	gotoxy(5, 16);
	printf("  ■■    ■■     ■■     ■■   ■■       ■■  ■■          ■■ ■   ■■      ■■     ■■       ■■  ■■     ■■   ■■");
	gotoxy(5, 17);
	printf("■■■■■■■■   ■■      ■■  ■■       ■■  ■■■■■■  ■■  ■  ■■      ■■     ■■       ■■  ■■■■■■    ■■■■■■ ");
	gotoxy(5, 18);
	printf("■■        ■■   ■■     ■■     ■■   ■■    ■■          ■■   ■ ■■      ■■      ■■     ■■   ■■      ■■  ■■ ");
	gotoxy(5, 19);
	printf("■■        ■■   ■■■■■           ■■        ■■■■■■  ■■    ■■■      ■■         ■■■■     ■■      ■■  ■■■■■■\n");

	
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 15); //인터페이스

	gotoxy(7, 30);
	printf("┏━━━━━━━━━━━━━┓\n");
	gotoxy(7, 31);
	printf("┃    △   : UP             ┃\n");
	gotoxy(7, 32);
	printf("┃  ◁  ▷ : LEFT / RIGHT   ┃\n");
	gotoxy(7, 33);
	printf("┃    ▽   : DOWN           ┃\n");
	gotoxy(7, 34);
	printf("┃   SPACE : SHOOT          ┃\n");
	gotoxy(7, 35);
	printf("┃    ESC  : Quit           ┃\n");
	gotoxy(7, 36);
	printf("┗━━━━━━━━━━━━━┛\n");

	int i;

	while(1)  //다양한 색깔 무한반복
	{
			for (i = 1; i <= 15; i++)
			{
					SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), i);
					gotoxy(58, 25);
					Sleep(300);
					printf("『  Press any key to start game  』\n");

					if (_kbhit())
						break;
			}
			if (_kbhit())
				break;
			
	}
	while (_kbhit()) _getch();
	return 0;
}

int reset()
{
	system("cls"); //화면 완전히 클리어
	while (_kbhit()) _getch(); //입력버퍼 비우기
	return 0;
}

int GameA()
{

	PlaySound(TEXT("music\\challenger.wav"), NULL, SND_ASYNC | SND_LOOP); //인게임 음악 무한루프
	map();
	return 0;
}

/* int Harry() //해리 움직이기 (이거 뭔가 나중에 수정해야할 것 같은 느낌......)
{
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 15);
	int x = 0, y = 17;
	char ch;
	gotoxy(x+5, y);
	printf("ㅁ");



	while (TRUE)
	{
		ch = _getch();

		gotoxy(x+5, y);
		printf(" ");
	
		switch (ch)
		{
		case (UP):
			if (y >= 0) y--;
			break;
		case (DOWN):
			if (y < 40) y++;
			break;

		case (LEFT):
			if (x >= 0) x--;
			break; 
		case (RIGHT):
			if (x < 150) x++;
			break;
		}
		gotoxy(x+5, y);
		printf("ㅁ");
	
	
	}
	

}
*/
int keeper(int(*map)[150], int X, int Y) { //2차원 배열과 좌표를 받음

	int checker;

	if (*(*(map + Y) + X) == 0) {
		checker = 1;
	} //좌표부분의 맵값이 0이면 1을 반환하고
	else if (*(*(map + Y) + X) == 2) {
		checker = 1;
	}
	else { checker = 0; } //0이 아니면 지나다니면 안된다는듯으로 0을 반환

	return checker;
}

int map() //배열로 맵 테두리를 
{
	int X = 4, Y = 3;
	int test, checker;
	int h1, h2;
	int map[40][150] =
	{
		{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
		{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}

	};
	gotoxy(0, 0);
	for (h1 = 0; h1 < 36; h1++)
	{
		for (h2 = 0; h2 < 74; h2++)
		{
			if (map[h1][h2] == 1)
			{
				printf("■");
			}
			else if (map[h1][h2] == 0)
			{
				printf("  "); //공백 두칸 띄워줘야해!!!!
			}

		}
		printf("\n");
	}
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 15);
	gotoxy(X, Y + 2);
	printf("●");

	while (1) {

		test = _getch(); //문자를 먼저 입력받는다
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 15);
		switch (test) { //입력받은 문자에 따라서 스위치문을 구성

		case UP: gotoxy(X, Y + 2);;
			printf(" ");//일단 지우고 시작합니다.
			Y -= 1;//좌표를 이동시켜본뒤에

			checker = keeper(map, X, Y);
			//map배열 주소와 좌표를 넘겨준다
			if (checker == 1) {
				gotoxy(X, Y + 2);
				printf("●");//지나가도 된다면 그자리에 출력해주고
				break;
			}
			else if (checker == 0)
			{
				Y += 1;//막힌길이면 좌표를 다시 되돌린후에
				gotoxy(X, Y + 2);
				printf("●");//다시 출력
				break;
			}
		case DOWN: gotoxy(X, Y + 2);
			printf(" ");
			Y += 1;
			checker = keeper(map, X, Y);
			if (checker == 1) {
				gotoxy(X, Y + 2);
				printf("●");
				break;
			}
			else if (checker == 0)
			{
				Y -= 1;
				gotoxy(X, Y + 2);
				printf("●");
				break;
			}

		case LEFT: gotoxy(X, Y + 2);
			printf(" ");
			X -= 2;

			checker = keeper(map, X, Y);
			if (checker == 1) {

				gotoxy(X, Y + 2);
				printf("●");

				break;
			}
			else if (checker == 0)
			{
				X += 2;
				gotoxy(X, Y + 2);
				printf("●");
				break;
			}

		case RIGHT:   gotoxy(X, Y + 2);
			printf(" ");
			X += 2;

			checker = keeper(map, X, Y);
			if (checker == 1) {

				gotoxy(X, Y + 2);
				printf("●");

				break;
			}
			else if (checker == 0)
			{
				X -= 2;
				gotoxy(X, Y + 2);
				printf("●");
				break;
			}

		} //switch닫음
		return 0;
	}
}

//자꾸 오류가 나서 다시 ...ㅠㅠㅠㅠㅠㅠㅠㅠ
